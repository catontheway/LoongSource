Quest_FDGJ = {}
Quest_FDGJ[1]={TargetType=QuestTargetType["Kill"], TargetID1=1006113, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19001}
Quest_FDGJ[2]={TargetType=QuestTargetType["Kill"], TargetID1=1006217, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19002}
Quest_FDGJ[3]={TargetType=QuestTargetType["Kill"], TargetID1=1006314, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19003}
Quest_FDGJ[4]={TargetType=QuestTargetType["Kill"], TargetID1=1006409, TargetID2=1006410, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19004}
Quest_FDGJ[5]={TargetType=QuestTargetType["Kill"], TargetID1=1007126, TargetID2=1007127, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19005}
Quest_FDGJ[6]={TargetType=QuestTargetType["Kill"], TargetID1=1007175, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19006}
Quest_FDGJ[7]={TargetType=QuestTargetType["Kill"], TargetID1=1009028, TargetID2=1009029, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19007}
Quest_FDGJ[8]={TargetType=QuestTargetType["Kill"], TargetID1=1009109, TargetID2=1009110, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19008}
Quest_FDGJ[9]={TargetType=QuestTargetType["Kill"], TargetID1=1009208, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19009}
Quest_FDGJ[101]={TargetType=QuestTargetType["Kill"], TargetID1=1006113, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19101}
Quest_FDGJ[102]={TargetType=QuestTargetType["Kill"], TargetID1=1006217, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19102}
Quest_FDGJ[103]={TargetType=QuestTargetType["Kill"], TargetID1=1006314, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19103}
Quest_FDGJ[104]={TargetType=QuestTargetType["Kill"], TargetID1=1006409, TargetID2=1006410, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19104}
Quest_FDGJ[105]={TargetType=QuestTargetType["Kill"], TargetID1=1007126, TargetID2=1007127, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19105}
Quest_FDGJ[106]={TargetType=QuestTargetType["Kill"], TargetID1=1007175, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19106}
Quest_FDGJ[107]={TargetType=QuestTargetType["Kill"], TargetID1=1009028, TargetID2=1009029, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19107}
Quest_FDGJ[108]={TargetType=QuestTargetType["Kill"], TargetID1=1009109, TargetID2=1009110, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19108}
Quest_FDGJ[109]={TargetType=QuestTargetType["Kill"], TargetID1=1009208, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19109}
Quest_FDGJ[201]={TargetType=QuestTargetType["Kill"], TargetID1=1006113, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19201}
Quest_FDGJ[202]={TargetType=QuestTargetType["Kill"], TargetID1=1006217, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19202}
Quest_FDGJ[203]={TargetType=QuestTargetType["Kill"], TargetID1=1006314, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19203}
Quest_FDGJ[204]={TargetType=QuestTargetType["Kill"], TargetID1=1006409, TargetID2=1006410, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19204}
Quest_FDGJ[205]={TargetType=QuestTargetType["Kill"], TargetID1=1007126, TargetID2=1007127, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19205}
Quest_FDGJ[206]={TargetType=QuestTargetType["Kill"], TargetID1=1007175, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19206}
Quest_FDGJ[207]={TargetType=QuestTargetType["Kill"], TargetID1=1009028, TargetID2=1009029, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19207}
Quest_FDGJ[208]={TargetType=QuestTargetType["Kill"], TargetID1=1009109, TargetID2=1009110, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19208}
Quest_FDGJ[209]={TargetType=QuestTargetType["Kill"], TargetID1=1009208, TargetID2=0, TargetID3=0, TargetID4=0, Num1=10, Num2=0, Num3=0, Num4=0, MsgID=19209}


--接取任务
function x20161_OnQuestInit(MapID, InstanceID, QuestID, OwnerID, NPCID)
	--得到表中的一个索引.
	local QuestType = role.GetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestType"])
	local rolelevel = role.GetRoleLevel(MapID, InstanceID, OwnerID)
	local Index = math.floor((rolelevel-1)/5) - 10
	if rolelevel == 55 then
	    Index = 1
	end
    --如果玩家接取的是普通任务,几率为65%，30%，5%。
	if QuestType == 1 then
	    local k = math.random(1, 100)
		if k <= 30 then
			Index = Index + 100
		elseif k <= 35 then
			Index = Index + 200
		end
	--如果玩家接取的是中等任务,几率为0%，90%，10%。
	elseif QuestType == 2 then
	    local k = math.random(1, 10)
		if k <= 9 then
				Index = Index + 100
		elseif k == 10 then
				Index = Index + 200
		end
	--如果玩家接取的是中等任务,几率为0%，0%，100%。
	elseif QuestType == 3 then
			Index = Index + 200
	end
	--初始化任务的动态数据
	role.QuestInit(OwnerID, QuestID, GetRandQuestTable(Quest_FDGJ, Index))
	role.SetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestID"], Index)

	--同步客户端任务说明
	local MsgID = msg.BeginMsgEvent()
	msg.AddMsgEvent(MsgID, 11, QuestID)
	msg.AddMsgEvent(MsgID, 1, Quest_FDGJ[Index].MsgID)
	msg.DispatchRoleMsgEvent(OwnerID, MsgID)

end


--完成任务
function x20161_OnComplete(MapID, InstanceID, QuestID, OwnerID, NPCID)
    --设置基础经验
	local Exp_award = {}
	Exp_award[1] = 9216
	Exp_award[2] = 11156
	Exp_award[3] = 13196
	Exp_award[4] = 15336
	Exp_award[5] = 17576
	Exp_award[6] = 19916
	Exp_award[7] = 22356
	Exp_award[8] = 24896
    Exp_award[9] = 27000

	--根据Index分三类，每类给予不同的经验倍数
	local Exp = 0
	local Index = role.GetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestID"])
	if Index ~= 0 then

	    local QuestType = math.floor(Index/100)  --0为普通任务，1为中等任务，2为高经验任务

	    Index = Index % 100  --经过换算，将Index跟9个经验分别对应

	    --计算经验奖励
	    if QuestType == 0 then
	        Exp = Exp_award[Index]
	    elseif QuestType == 1 then
	        Exp = Exp_award[Index] * 2
	    elseif QuestType == 2 then
	        Exp = Exp_award[Index] * 4
	    end

	    --奖励玩家经验
	    role.AddRoleExp(MapID, InstanceID, OwnerID, Exp)

        --提示：“您获得了XX点经验”
	    local MsgID = msg.BeginMsgEvent()
		msg.AddMsgEvent(MsgID, 26, 723)
	    msg.AddMsgEvent(MsgID, 9, Exp)
	    msg.DispatchRoleMsgEvent(OwnerID, MsgID)
	end

	--设置玩家身上的标记位为0
	role.SetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestType"], 0)
	role.SetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestID"], 0)

	--增加进阶实力值
	Increase_shili(MapID, InstanceID, OwnerID, 0, 5,"jinjieshili_A")
end

--放弃任务
function x20161_OnCancel(MapID, InstanceID, QuestID, OwnerID)
	--设置玩家身上的标记位为0
	role.SetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestType"], 0)
	role.SetRoleScriptData(OwnerID, 1, RoleDataType["FDGJ_QuestID"], 0)
end

aux.RegisterQuestEvent(20161, 1, "x20161_OnComplete")
aux.RegisterQuestEvent(20161, 7, "x20161_OnQuestInit")
aux.RegisterQuestEvent(20161, 2, "x20161_OnCancel")


